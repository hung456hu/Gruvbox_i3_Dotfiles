#!/bin/bash
# set-wall: đặt wallpaper và cập nhật betterlockscreen

IMG="$1"

# Kiểm tra tham số
if [ -z "$IMG" ]; then
  echo "Usage: set-wall <image>"
  exit 1
fi

# Lấy đường dẫn tuyệt đối
IMG_PATH="$(realpath "$IMG")"

# Kiểm tra file tồn tại
if [ ! -f "$IMG_PATH" ]; then
  echo "File không tồn tại: $IMG_PATH"
  exit 1
fi

# Đặt wallpaper
feh --bg-fill "$IMG_PATH"

# Cập nhật betterlockscreen (blur từ wallpaper)
betterlockscreen -u "$IMG_PATH" --blur 0.5

# Lưu lại để autostart
mkdir -p "$HOME/.config/i3"
cat >"$HOME/.config/i3/wallpaper.sh" <<EOF
#!/bin/sh
feh --bg-fill "$IMG_PATH"
EOF

chmod +x "$HOME/.config/i3/wallpaper.sh"

echo "✅ Wallpaper + lockscreen đã được cập nhật:"
echo "   $IMG_PATH"
